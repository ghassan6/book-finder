{% extends "layout.html" %}

{% block title  %} Book_info {% endblock %}

{% block main %}

  
   <div class="container">
        <div class="row text-start">
            <div class="col-2" >
                
                <img src="{{book['img']}}" alt="{{book['title']}}" width="180" height="220">
                
            </div>
            
            <div class="col pt-3 border-bottom border-3">
                <p class="fs-4"><strong>{{book["title"]}}</strong></p>          
                <div class="row">
                    <div class="col-3">
                        <p><strong>Author: </strong>{{book["authors"]}}</p>

                        {% if book['category'] != "" %}
                            <p><strong>Category: </strong>{{category}}</p>
                        {% endif %}
                        {% if book['publisher']%}
                        <p><strong>Publisher: </strong>{{book.publisher}}</p>
                        {% endif %}
                    </div>    
                    <div class="col ">
                        <p><strong>Identifier: </strong> {{book['identifier']}}</p>
                                    
                        <p><strong>Pages: </strong>{{book["pages"]}}</p>
                        
                        {% if book["date"]%}
                        <p><strong>Published date: </strong> {{book["date"]}}</p>
                        {% endif %}

                    </div>
                </div>
            </div>

            <div class="row mt-3 mb-3">
                <p><strong>Description: </strong>{{book["desc"]}}</p>
            </div>
            
        </div>

   </div>

   <div class="container" style="position: relative;">
        <div class="row text-start" >
            <div class="col-6" >
                <button class="me-2 mb-3 btn btn-primary" id="btn1" value="{{book['id']}}" onclick="add_list()">Want to read</button>
                <button class="mb-3 btn btn-secondary" id="btn2" value="{{book['id']}}" onclick="read_list()">Have read</button>
                <a href="{{book['googleLink']}}" target="_blank"><button class="btn mb-3 ms-2 google">View on Google books</button></a>
            </div>


   </div>

   <div class="text-start flash" >Book added successfully!</div>
   </div>

   <script>

    async function add_list() {
        let btn = document.querySelector("#btn1")
        let flash = document.querySelector(".flash")
        
        let id = '{{session["user_id"]}}'
        
        if (id == "") window.location.href = '/login'
        
        fetch(`${window.origin}/add_list/want to read` , {
            method: "POST",
            cache: 'no-cache',
            credentials: 'include',
            body: JSON.stringify(btn.value),
            headers: new Headers({
                'content-type': 'application/json'
            })
        })

        setTimeout(() => {
            flash.classList.add('show-flash')
        } , 500)
        
        setTimeout(() => {
             flash.classList.remove('show-flash')  
                 
            }, 2000)
    }

    async function read_list() {
        let btn = document.querySelector("#btn2")
        let flash = document.querySelector(".flash")
        let id = '{{session["user_id"]}}'

        if (id == "") window.location.href = '/login'
    
        fetch(`${window.origin}/add_list/have read` , {
            method: "POST",
            credentials: "include",
            cache: "no-cache",
            body: JSON.stringify(btn.value),
            headers: new Headers ({
                'content-type': 'application/json'
            })

        })

        setTimeout(() => {
            flash.classList.add('show-flash')
        } , 500)
        
        setTimeout(() => {
             flash.classList.remove('show-flash')  
                 
            }, 2000)
    }

   </script>
   
{% endblock %}

